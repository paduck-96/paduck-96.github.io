---
title: "Java Spring Boot 의 다 대 다 관계"
excerpt: "Spring Boot의 다 대 다 관계에 대해 학습하고,
이를 활용해 실습 진행한다"

categories:

- Blog
  tags:
- [Blog, kakaocloudschool, develop, java, spring boot, M:M, 다 대 다]

toc: true
toc_sticky: true

date: 2023-01-16
last_modified_at: 2023-01-16

---

### 게시글 화면에 댓글 출력

- 게시글 처리를 위한 Controller를 생성

  - 게시글 번호에 해당하는 댓글을 리턴해주는 메서드 작성

- read.html 파일에 댓글을 출력하는 영역을 생성

  - 댓글 개수를 출력 영역 클릭시 댓글 영역에 출력하는 스크립트 작성

### 댓글 추가

- 댓글 추가 및 삭제 그리고 수정을 위한 모달

  - **Modal**  
    `대화상자를 제거하기 전에는 원래 영역으로 돌아갈 수 없는 창`  
    HTML에서는 팝업 창같은 대화상자 창

- ReplyController 클래스에 댓글 추가를 위한 메서드를 생성

- 작성 버튼을 눌렀을 때 댓글 창을 화면에 출력하는 스크립트를 추가

- 댓글을 클릭하면 댓글의 내용을 대화상자에 출력하는 스크립트 코드 추가

### 댓글 삭제

- ReplyController 클래스에 댓글 삭제 요청 처리 메서드를 작성

### 댓글 수정

- ReplyController 클래스에 댓글 수정 요청 처림 메서드 추가

---

# 테이블 사이의 관계

## 1. M:M 관계

### M:M 관계

- 테이블 하나의 행이 다른 테이블의 여러 개 행과 매핑 되고,  
  반대로 상대방 테이블에서도 하나의 행이 다시 여러 개 행과 매핑
  - 쇼핑몰에서 회원 정보 와 상품 정보  
    한 명의 회원은 여러 종류 상품 구매 가능,  
    하나의 상품은 여러 회원에게 구매됨
  - 영화 와 회원 사이의 리뷰 관계  
    하나의 영화에 여러 회원이 리뷰 가능,  
    한 명의 회원이 여러 영화에 리뷰 가능

### 관계형 DB 에서 M:M 관계 표현

- 관계형 DB는 `다 대 다 관계 표현 어려움`
  - `1:M 관계 2개로 분할`해서 표현  
    별도의 테이블을 만들어 처리
- `별도의 테이블`을 만들고 `2개의 테이블의 기본키를 외래키`로 소유

### JPA 에서의 M:M 관계

- ManyToMany로 다 대 다 관계 표현 가능
  - `실제로 거의 사용하지 않음`  
    하나의 영화에 대해 한 명이 리뷰 작성시 영화 와 회원,  
    2곳에서 데이터 삽입이 이루어져 `데이터 불일치 발생 가능성` 존재

### 다 대 다 매핑 기준

- 연결 테이블의 기본키 설정
  - **식별 관계**  
    `양쪽 테이블의 기본키를 받아 외래키`로 생성,  
    이 `기본키의 조합`을 기본키로 사용
  - **비식별 관계**  
    `양쪽 테이블의 기본키를 받아 외래키`로 생성,  
    `별도의 키`를 만들어서 기본키로 사용
- 별도의 클래스 생성  
  별도의 클래스 생성해서 사용
  - 별도의 클래스 만들지 않고 @ManyToMany 와 @JoinTable 이용

## 2. 영화 리뷰 프로젝트

```
- 회원 정보
- 영화 정보(영화 제목)
- 첨부 파일(여러 개 가능)

  영화 아이디를 만들어 영화 아이디 와 제목을 갖는 테이블 생성,
  영화 아이디와 첨부 파일을 갖는 별도 테이블 생성

- 리뷰 정보
  리뷰 번호, 영화와 1:N, 회원 과 1:N

- 평점
- 감상문
```

## 3. 프로젝트 기본 설정

### 의존성

- lombok, spring web, thymeleaf, jpa, DB 드라이버

### application.properties 파일을 yml 로 변경 후 설정 추가

### jpa 감시 어노테이션 추가

- @**EnableJpaAuditing**

## 4. Entity 작업

### 여러 곳에서 공통 사용되는 속성의 Entity 생성

### 사용되어질 domain 객체 추가

- `baseEntity 상속`

## 5. Repository 인터페이스 생성

- **JpaRepository**<엔티티이름, 기본키 자료형> extends

## 6. 샘플 데이터 삽입

### test 데이터 삽입

- MovieImage 의 삽입은 Movie 삽입과 동시에 진행

## 7. 메인 화면 출력 쿼리 연습

### MovieRepository 인터페이스에 메서드 선언
